<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Flutter, Rust ve gRPC ile Işık Hızına Çıkın -Ahmet CAN </title> <script data-ad-client="ca-pub-3787646629594216" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Rust gRPC ve Flutter kullanarak donanımı en yüksek verimlilikte kullanabileceğiniz http/2 temelli mobil-fullstack uygulama geliştirme - Flutter, Rust ve gRPC ile Işık Hızına Çıkın - Senior Software Developer, Web And Mobile Full-Stack , Speaks English and Turkish"> <meta name="keywords" content="Flutter, Rust ve gRPC ile Işık Hızına Çıkın, Ahmet CAN, rust, flutter, gRPC,flutter, rust, grpc ,android,ios,development, dart, macos, linux, protobuf,flutter,gRPC,c#,.net,dotnetcore,dotnet,core,android,kotlin,python,nodejs,keras,tensorflow,machine learning,neural networks, ,vuejs,vue,vue.js,vuetify,javascript,es5,es6,typescript,asp.net,asp,net,webform,mvc,webapi,rest,firebase,firestore,cloud functions, analytics,big data,google,amazon,aws,azure,s3,sqs,sql,linux,environment,ubuntu,debian,arch,fedora,nodejs,expressjs,sdk,c++, wpf,wcf,soap,html,css3,css,jquery,linq,entity framework,code-first,database-first, mysql,mssql,server,client,tsql,postgresql,nosql,mongodb,cochbase,back-end,backend,rabitmq,msmq,rdis,memcache,haproxy, ,oracle,plsql,stored procedure,websocket,socketio,socket-io,signalr, docker,kubernate,elb,web,pip,pip3,npm,yarn, gan,segmentation,face recognation,body part segmentation,panoptic,dense,densepose,openpose,opencv,image,pillow,generative,neural networks, encoder,decoder,convolution,network,tensorflow light,torch,dataset,validation "/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Ahmet CAN" property="og:site_name" /> <meta content="Flutter, Rust ve gRPC ile Işık Hızına Çıkın" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Rust gRPC ve Flutter kullanarak donanımı en yüksek verimlilikte kullanabileceğiniz http/2 temelli mobil-fullstack uygulama geliştirme" property="og:description" /> <meta content="https://ahmetcan.com.tr/blog/flutter-rust-grpc/" property="og:url" /> <meta content="2020-12-29T04:52:00+00:00" property="article:published_time" /> <meta content="https://ahmetcan.com.tr/about/" property="article:author" /> <meta content="https://ahmetcan.com.tr/assets/img/rust.png" property="og:image" /> <meta content="rust" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Flutter, Rust ve gRPC ile Işık Hızına Çıkın" /> <meta name="twitter:url" content="https://ahmetcan.com.tr/blog/flutter-rust-grpc/" /> <meta name="twitter:description" content="Rust gRPC ve Flutter kullanarak donanımı en yüksek verimlilikte kullanabileceğiniz http/2 temelli mobil-fullstack uygulama geliştirme" /> <link rel="stylesheet" href="https://ahmetcan.com.tr/assets/css/main.css" /> <link rel="stylesheet" href="https://ahmetcan.com.tr/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="https://ahmetcan.com.tr/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="https://ahmetcan.com.tr/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css"/> <link rel="stylesheet" href="https://ahmetcan.com.tr/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="https://ahmetcan.com.tr/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'https://ahmetcan.com.tr' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="https://ahmetcan.com.tr/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://ahmetcan.com.tr/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> <!-- Matomo --> <script> var _paq = window._paq = window._paq || []; /* tracker methods like "setCustomDimension" should be called before "trackPageView" */ _paq.push(["setCookieDomain", "*.ahmetcan.com.tr"]); _paq.push(['trackPageView']); _paq.push(['enableLinkTracking']); (function() { var u="https://xmachine.uk/mtm/"; _paq.push(['setTrackerUrl', u+'matomo.php']); _paq.push(['setSiteId', '4']); var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s); })(); </script> <!-- End Matomo Code --> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="https://ahmetcan.com.tr">Ahmet CAN</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://ahmetcan.com.tr/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="https://ahmetcan.com.tr/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="https://ahmetcan.com.tr/blog" >Blog</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="col-lg-12"> <div class="row" id="blog-post-container"> <div style="position:fixed;top: 100px;left:0;"> <iframe width="210" height="160" src="https://www.youtube.com/embed/nf0llz_Rfd0?start=2190&autoplay=1&mute=0"></iframe> </div> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Flutter, Rust ve gRPC ile Işık Hızına Çıkın</h1> <h4 class="post-meta">Rust gRPC ve Flutter kullanarak donanımı en yüksek verimlilikte kullanabileceğiniz http/2 temelli mobil-fullstack uygulama geliştirme</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"> <a href="https://ahmetcan.com.tr/blog/authors/ahmetcan">ahmetcan</a> </span> </span> at <time datetime="2020-12-29 04:52:00 +0000" itemprop="datePublished"> Dec 29, 2020 </time> </p> <div class="post-categories"> Category : <a href="/blog/categories/rust" >rust</a> &nbsp; <a href="/blog/categories/flutter" >flutter</a> &nbsp; <a href="/blog/categories/gRPC" >gRPC</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://ahmetcan.com.tr/assets/img/rust.png" alt="" /> <br /> <br /> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Geliştirme Ortamı:
Ubuntu 20.10 
Visual Studio Code
Flutter SDK
Rust SDK
</code></pre></div></div> <p><strong>Kodların tamamını github üzerinden indirebilirsiniz!</strong> <strong><a href="https://github.com/ahmetcancomtr/flutter_rust_grpc">https://github.com/ahmetcancomtr/flutter_rust_grpc</a></strong></p> <p>Yazıya başlamadan önce Günümüzde popularitesini arttıran Rust ve gRPC gibi teknolojileri neden kullanmalıyız değinmek istiyorum.</p> <p>Rust Mayıs/2015 te 1.0 versionu çıkmış 2016 stackoverflow da en populer dil olarak seçilmiştir. Peki bu hızlı yükselişin ardında ne var. Performans olarak en hızlı programlama dili dediğimizde aklımıza C dili geliyor.C dilide yazılan kodlar derlendiği zaman öz ve doğrudan araya bir katman girmeden çok hızlı çalışabilecek makine kodlarına dönüştürülüyor.C dili bu yüzden sistem programlamada ağırlıklı olarak kullanıyor. Günümüzde uygulama programlama alanında c ve c++ gibi diller pek tercih edilmiyor. C#,java JavaScript gibi üst seviye diller, öğrenme eğrisinin yüksek olması ve nispeten daha kolay anlalışabilir olduğu için uygulama programcıları tarafından daha çok tercih ediliyor.CLR,JVM,JIT gibi runtime katmanları üzerine kurgulanmış bu diller cross platform ve moduler geliştirme konusunda yüksek uyumluluk sağlıyor. Peki neler kaybettiriyor ? Tabi ki performanstan ödün vermek zorunda kalıyoruz. Günümüzde Net framework 5 çıkmasıyla optimizasyonu çok iyi duruma gelen .Net Framework en hızlı haliyle bile C programlama dilinin oluşturduğu kodlardan çok daha yavaş çalışıyor ve donanım kaynaklarını daha fazla tüketiyor. Bunun nedeni CLR runtime tarafından yorumlanan ara kodların makine kodlarına dönüştürülme safhası.Ayrıca programcıların kolay memory management yapabilmesi açısından Garbage Collection bir mekanizmanın olması çok büyük bir etken.</p> <p><strong>O zaman ihtiyacımız olan şey C kadar hızlı aynı zamanda C#,jAVA vs.. gibi üst seviye diller kadar kolay yazım ve effektif memory management sunabilecek bir programalma dili.</strong></p> <p>RUST performansını C dili karşılaştırabiliriz,Özellikle C++ demiyorum kendi denemelerimde C++ dan daha hızlı çalıştığını gördüm. Şöyle ki yazılmış bir benchmark kodunda oluşturulan algoritma</p> <table> <thead> <tr> <th style="text-align: left"> </th> <th style="text-align: left"> </th> <th style="text-align: center"> </th> </tr> </thead> <tbody> <tr> <td style="text-align: left">1.</td> <td style="text-align: left">C(clang)</td> <td style="text-align: center">0.7 sn</td> </tr> <tr> <td style="text-align: left">2.</td> <td style="text-align: left"><strong>Rust(1.48.0)</strong></td> <td style="text-align: center"><strong>0.8 sn</strong></td> </tr> <tr> <td style="text-align: left">3.</td> <td style="text-align: left">C++(g++)</td> <td style="text-align: center">1.5 sn</td> </tr> <tr> <td style="text-align: left">4.</td> <td style="text-align: left">Go(1.14.7)</td> <td style="text-align: center">3.9 sn</td> </tr> <tr> <td style="text-align: left">5.</td> <td style="text-align: left">C#(Net5)</td> <td style="text-align: center">5.1 sn</td> </tr> <tr> <td style="text-align: left"> </td> <td style="text-align: left"> </td> <td style="text-align: center"> </td> </tr> </tbody> </table> <p>gibi bir sürede tamamlandı Peki bu kadar hızlı olmasının nedeni nedir ?!.. Tabi ki C dili gibi araya hiçbir katman girmeden, doğrudan makine kodlarına dönüştürülmesi ve garbage collection gibi yöntemler yerine referance-ownership ve borrow-check gibi yöntemlerle maliyeti düşük memory management yapabilmesi. Şimdilik bu kadar yeterli <strong>RUST</strong> hakkında daha detaylı bilgilere <a href="https://doc.rust-lang.org/book/">referans dökümanlardan</a> ulaşabilirsiniz.</p> <p>Peki Rest/websocket yerine neden gRPC kullanıyorum derseniz ona da kısaca değinmekte fayda var. Daha henüz tam anlamıyla desteklenmeyen, http/2 ile gelen yeniliklerden biri olan gRPC, performans açısından rest arasında çok ciddi farklar var . Bunun hakkında yapılmış benchmark çalışmalarını incelemenizi tavsiye ederim.gRPC, web tarafında tüm browserlar tarafından henüz tam olarak desteklenmiyor fakat mobil istemcilerde kullanmanız herhangi bir sorun oluşturmaz.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Basit olarak senaryo şu şekilde olacak...
Flutter uygulaması yazacağım,iki text alanı olacak.
Bu uygulama  gRPC istemicisi olarak çalışacak. 
Text kutularından birine yazı yazıldığında server a gidecek ve dönen cevap diğer text kutusuna yazılacak.
Server içerik üzerinde bir değişiklik yapmayacağı için "echo server" server diyebiliriz.
</code></pre></div></div> <h2 id="rust-ile-grpc-sunucu-uygulaması">RUST ile gRPC sunucu uygulaması</h2> <p><strong>Rust</strong> üzerinde gRPC kullanabilmemizi sağlayacak framework’ün ismi <strong><a href="https://github.com/hyperium/tonic">tonic</a></strong></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bu aşamada,RUST geliştirme ortamının kurulmuş olduğunu varsayıyorum.
</code></pre></div></div> <p>Aşağıdaki shell komutlarını çalıştırıyoruz</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>cargo new echo-server
</code></pre></div></div> <p>Şimdi oluşturalan proje dizinini visual studio code ile açalım</p> <p>ardından proto isminde bir dizin oluşturalım. Onun altına da echo.proto isminde bir dosya oluşturuyoruz. içeriği şu şekilde olacak.</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>
<span class="kn">package</span> <span class="nn">echopackage</span><span class="p">;</span>

<span class="kd">service</span> <span class="n">Echo</span> <span class="p">{</span>
    <span class="k">rpc</span> <span class="n">do_echo</span> <span class="p">(</span><span class="n">EchoRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">EchoReply</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">EchoRequest</span> <span class="p">{</span>
   <span class="kt">string</span>  <span class="na">source_content</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">EchoReply</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">reply_content</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>ve aşağıdaki gibi görünecek <img src="/assets/img/posts/echo_proto.png" alt="alt text" title="echo.proto" /></p> <p>Bu tanım , <strong>tonic</strong> tarafından gRPC server proxy kodlarının üretilmesinde kullanılacak.Ayrıca bu proto tanımı flutter uygulamasının kullanacağı gRPC client proxy kodlarının üretilmesinde de kullanılacak. Böylece sunucu ve istemci arasında gerçekleşecek haberleşme protobuf formatında tam uyumlu olmuş olacak. Hala henüz bu konuda bilmediğiniz bazı şeyler olduğunu düşünüyorsanız, <a href="https://developers.google.com/protocol-buffers">protobuf</a> formatına detaylı bakabilirsiniz.<strong><em>(JSON yerine kullanılan binary format)</em></strong></p> <p>Şimdi rust ın kullanacağı bağımlılıkları ekleyelim Cargo.toml dosyasını açın ve aşağıdaki satırları kopyalayın</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">[</span><span class="nv">package</span><span class="pi">]</span>
<span class="s">name = "echo-server"</span>
<span class="s">version = "0.1.0"</span>
<span class="s">authors = ["ahmet can &lt;mail@ahmetcan.com.tr&gt;"]</span>
<span class="s">edition = "2018"</span>

<span class="pi">[</span><span class="nv">dependencies</span><span class="pi">]</span>
<span class="s">tonic = "0.3"</span>
<span class="s">prost = "0.6"</span>
<span class="s">tokio = { version = "0.2", features = ["macros"] }</span>

<span class="pi">[</span><span class="nv">build-dependencies</span><span class="pi">]</span>
<span class="s">tonic-build = "0.3"</span>
</code></pre></div></div> <p>projenin root dizine build.rs isminde bir dosya oluşturun ve aşağıda verilmiş olan kodları ekleyin bu <strong>tonic</strong> tarafından çalıştılacak ve derleme aşamasında gRPC proxy kodların üretilmesini sağlayacak.</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="nn">tonic_build</span><span class="p">::</span><span class="nf">compile_protos</span><span class="p">(</span><span class="s">"proto/echo.proto"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div> <p>Aşağıdaki kodları src/main.rs içine kopyalayın</p> <div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">tonic</span><span class="p">::{</span><span class="nn">transport</span><span class="p">::</span><span class="n">Server</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">Status</span><span class="p">};</span>

<span class="k">use</span> <span class="nn">echo_grpc</span><span class="p">::</span><span class="nn">echo_server</span><span class="p">::</span> <span class="p">{</span><span class="n">Echo</span><span class="p">,</span> <span class="n">EchoServer</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">echo_grpc</span><span class="p">::{</span><span class="n">EchoReply</span><span class="p">,</span> <span class="n">EchoRequest</span><span class="p">};</span>

<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">net</span><span class="p">::{</span><span class="n">IpAddr</span><span class="p">,</span> <span class="n">Ipv4Addr</span><span class="p">,</span> <span class="n">SocketAddr</span><span class="p">};</span>

<span class="k">pub</span> <span class="k">mod</span> <span class="n">echo_grpc</span> <span class="p">{</span>
    <span class="nn">tonic</span><span class="p">::</span><span class="nd">include_proto!</span><span class="p">(</span><span class="s">"echopackage"</span><span class="p">);</span> 
<span class="p">}</span>

<span class="nd">#[derive(Debug,</span> <span class="nd">Default)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">EchoImpl</span> <span class="p">{}</span>

<span class="nd">#[tonic::async_trait]</span>
<span class="k">impl</span> <span class="n">Echo</span> <span class="k">for</span> <span class="n">EchoImpl</span> <span class="p">{</span>
    <span class="k">async</span> <span class="k">fn</span> <span class="nf">do_echo</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="o">&lt;</span><span class="n">EchoRequest</span><span class="o">&gt;</span><span class="p">,)</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&lt;</span><span class="n">EchoReply</span><span class="o">&gt;</span><span class="p">,</span><span class="n">Status</span><span class="o">&gt;</span> <span class="p">{</span> 
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Got a request: {:?}"</span><span class="p">,</span> <span class="n">request</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">reply</span> <span class="o">=</span> <span class="nn">echo_grpc</span><span class="p">::</span><span class="n">EchoReply</span> <span class="p">{</span>
            <span class="n">reply_content</span><span class="p">:</span> <span class="n">request</span><span class="nf">.into_inner</span><span class="p">()</span><span class="py">.source_content</span><span class="p">,</span>
        <span class="p">};</span>
        <span class="nf">Ok</span><span class="p">(</span><span class="nn">Response</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">reply</span><span class="p">))</span> 
    <span class="p">}</span>
<span class="p">}</span>


<span class="nd">#[tokio::main]</span>
<span class="k">async</span> <span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span> <span class="nn">std</span><span class="p">::</span><span class="nn">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
   <span class="c">// let addr = "[::1]:50051".parse()?;</span>
    <span class="k">let</span> <span class="n">socket</span> <span class="o">=</span> <span class="nn">SocketAddr</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nn">IpAddr</span><span class="p">::</span><span class="nf">V4</span><span class="p">(</span><span class="nn">Ipv4Addr</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="mi">50051</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">echoservice</span> <span class="o">=</span> <span class="nn">EchoImpl</span><span class="p">::</span><span class="nf">default</span><span class="p">();</span>

    <span class="nn">Server</span><span class="p">::</span><span class="nf">builder</span><span class="p">()</span>
        <span class="nf">.add_service</span><span class="p">(</span><span class="nn">EchoServer</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">echoservice</span><span class="p">))</span>
        <span class="nf">.serve</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
        <span class="k">.await</span><span class="o">?</span><span class="p">;</span>

    <span class="nf">Ok</span><span class="p">(())</span>
<span class="p">}</span>
</code></pre></div></div> <p>aşağıdaki shell komutunu çalıştırın</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>cargo run 
</code></pre></div></div> <p><strong>artık gRPC sunucumuz hizmet vermeye başladı</strong></p> <h2 id="flutter-ile-grpc-istemci-uygulaması">Flutter ile gRPC istemci uygulaması</h2> <p>Şimdi gRPC istemcisi için Flutter Uygulamasını hazırlayalım</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Bu aşamada Flutter geliştirme ortamının kurulduğunu varsayıyorum
</code></pre></div></div> <p>Aşağıdaki komutu shell komutunu çalıştırıp flutter uygulaması oluşturuyoruz ve projeyi visual studio code ile açıyoruz</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>flutter create echoclient
</code></pre></div></div> <p>öncelikle dart için gRPC plugin kurulumunu yapalım,<strong>ben linux için anlatıyorum</strong></p> <p><a href="https://github.com/protocolbuffers/protobuf/releases">https://github.com/protocolbuffers/protobuf/releases</a></p> <p>bu adresten ilgili toolu indirip sistem <strong>path</strong> listesine ekleyin</p> <p>aşağıdaki komutu yazarak protobuf plugin active edin</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>flutter pub global activate protoc_plugin
</code></pre></div></div> <p>daha önce bahsetmiş olduğum sunucu tarafında kullandığımız <strong>echo.proto</strong> dosyasını <strong>echoclient/proto</strong> dizinine kopyalayın</p> <p>aşağıdaki komutu çalıştırın ve proxy dosyalarını oluşturun.Bu dosyalar <strong>lib/protos</strong> dizinine oluşturulacak</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>protoc <span class="nt">--dart_out</span><span class="o">=</span>grpc:lib/  proto/echo.proto
</code></pre></div></div> <p>şimdi flutter projesi <strong>pubspec.yaml</strong> dosyasına gelelelim aşağıdaki paketleri ekleyelim</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">dependencies</span><span class="pi">:</span>
    <span class="s">...</span>
  <span class="s">grpc</span><span class="pi">:</span> <span class="s">^1.0.1</span>
  <span class="na">protobuf</span><span class="pi">:</span> <span class="s">^0.13.4</span>
  <span class="na">crypto</span><span class="pi">:</span> <span class="s">^2.0.6</span>
</code></pre></div></div> <p><strong>lib</strong> dizini altına <strong>echoservice.dart</strong> adına bir dosya oluşturalım ve aşağıdaki kodları ekleyelim.</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="s">'package:echoclient/proto/echo.pb.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:echoclient/proto/echo.pbgrpc.dart'</span><span class="o">;</span>
<span class="kn">import</span> <span class="s">'package:grpc/grpc.dart'</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">EchoService</span> <span class="o">{</span>
  <span class="kd">static</span> <span class="n">EchoClient</span> <span class="n">client</span><span class="o">;</span>

  <span class="n">EchoService</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">EchoClient</span><span class="o">(</span>
      <span class="n">ClientChannel</span><span class="o">(</span>
        <span class="s">"192.168.1.33"</span><span class="o">,</span>
        <span class="nl">port:</span> <span class="mi">50051</span><span class="o">,</span>
        <span class="nl">options:</span> <span class="n">ChannelOptions</span><span class="o">(</span>
          <span class="nl">credentials:</span> <span class="n">ChannelCredentials</span><span class="o">.</span><span class="na">insecure</span><span class="o">(),</span>
        <span class="o">),</span>
      <span class="o">),</span>
    <span class="o">);</span>
  <span class="o">}</span>

  <span class="n">Future</span><span class="o">&lt;</span><span class="n">EchoReply</span><span class="o">&gt;</span> <span class="n">commitMessage</span><span class="o">(</span><span class="kt">String</span> <span class="n">body</span><span class="o">)</span> <span class="n">async</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">do_echo</span><span class="o">(</span>
      <span class="n">EchoRequest</span><span class="o">()</span>
        <span class="o">..</span><span class="na">sourceContent</span><span class="o">=</span><span class="n">body</span>
        
    <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Şimdi yukardaki kodları uygulamanın UI kısmında kullanalım.</p> <p>main.dart altında ilgili değişiklikleri yaptık bir tane TextField ile string değeri alıyoruz ve bunu gönderiyoruz gelen cevabı da bir Text ile gösteriyoruz.</p> <div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">...</span>
  <span class="kt">String</span> <span class="n">_reply</span><span class="o">=</span><span class="s">""</span><span class="o">;</span>
  <span class="kd">var</span> <span class="n">service</span><span class="o">=</span><span class="n">EchoService</span><span class="o">();</span>
  <span class="kd">var</span> <span class="n">currentReply</span><span class="o">=</span><span class="s">""</span><span class="o">;</span>
  <span class="kd">final</span> <span class="n">request_text_controller</span> <span class="o">=</span> <span class="n">TextEditingController</span><span class="o">();</span>
  <span class="kt">void</span> <span class="n">_sendToServer</span><span class="o">()</span> <span class="n">async</span><span class="o">{</span>
    <span class="kd">var</span> <span class="n">reply</span><span class="o">=</span><span class="n">await</span> <span class="n">service</span><span class="o">.</span><span class="na">commitMessage</span><span class="o">(</span><span class="n">request_text_controller</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
    <span class="n">setState</span><span class="o">(()</span> <span class="o">{</span>
       <span class="n">_reply</span><span class="o">=</span><span class="n">reply</span><span class="o">.</span><span class="na">replyContent</span><span class="o">;</span>
    <span class="o">});</span>
  <span class="o">}</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="o">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
<span class="o">....</span>
</code></pre></div></div> <p>aşağıdaki shell komutunu kullanarak flutter uygulamamızı çalıştıralım</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>flutter run
</code></pre></div></div> <p>butona bastığımız zaman</p> <p><img src="/assets/img/posts/sonuc.png" alt="alt text" title="Sonuç" /></p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <style> .IN-widget { transform: scale(1.5); } .linkedin-button { margin: 0; vertical-align: center; padding-bottom: 10px; margin-top: -10px; margin-right: 10px; } .share-page ul { list-style-type: none; margin: 0; padding: 0; overflow: hidden; background-color: #333333; } .share-page li { /*display: inline-block;*/ /* You can also add some margins here to make it look prettier */ zoom: 1; *display: inline; /* this fix is needed for IE7- */ margin: 0; } .share-page .linkedin { top: -25px; margin-right: 15px; } </style> <script> (function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> <div class="share-page"> <!--<p class="share-text">Share this on &rarr;</p>--> <div class="linkedin-button"> <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script> <script type="IN/Share" data-size="large" data-url="https://ahmetcan.com.tr/blog/flutter-rust-grpc/"></script> </div> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;">Tweet</a> <a class="fb-share-button" data-href="https://ahmetcan.com.tr/blog/flutter-rust-grpc/" data-size="large" data-layout="button">Share</a> </div> </div><!-- Author box --> <div class="card"> <div class="card-header"> Ahmet Can </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="https://ahmetcan.com.tr/assets/img/authors/ahmetcan.png" alt="Ahmet Can" /> </div> <div class="col-md-6"> <p class="author_bio">Senior Software Developer</p> <p>Email : <a href = "mailto: mail@ahmetcan.com.tr">mail@ahmetcan.com.tr</a></p> <p>Website : https://ahmetcan.com.tr</p> <p class="profile-links"> <a class="social-link" href="https://github.com/ahmetcancomtr" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/ahmetcancomtr" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.youtube.com/channel/UCnbQGwnI179nM9WhuIFP9zQ" target="_blank"><i class="fab fa-youtube fa-fw"></i></a> <a class="social-link" href="https://www.facebook.com/ahmetcancomtrfb" target="_blank"><i class="fab fa-facebook fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/ahmetcancomtr" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> <a class="social-link" href="https://instagram.com/ahmetcancomtr" target="_blank"><i class="fab fa-instagram fa-fw"></i></a> <a class="social-link" href="https://medium.com/ahmetcancomtr" target="_blank"><i class="fab fa-medium fa-fw"></i></a> </p> </div> </div> </div> </div> </div><script> /*function UpdateEntryComment(url) { var url = "https://api.github.com/user"; var request = new XMLHttpRequest(); request.open('GET', url, true); request.onload = function () { console.log(this.response); if (this.status >= 200 && this.status < 400) { var response = JSON.parse(this.response); document.getElementById('github-comments').appendChild(createCommentEntryEl(response[0])); } else { console.error(this); } UpdateComments(); }; request.send(); };*/ function UpdateComments(url) { var url = "https://api.github.com/repos/ahmetcancomtr/ahmetcancomtr.github.io/issues/1/comments"; var request = new XMLHttpRequest(); request.open('GET', url, true); request.onload = function () { if (this.status >= 200 && this.status < 400) { let response = JSON.parse(this.response); if (response.length > 0) { for (var i = 0; i < response.length; i++) { document.getElementById('gh-comments-list').appendChild(createCommentEl(response[i])); } } else { alert("add first comment"); } if (0 === response.length) { document.getElementById('no-comments-found').style.display = 'block'; } } else { console.error(this); } }; request.send(); }; function createCommentEl(response) { var user = document.createElement('a'); user.setAttribute('href', response.user.url.replace('api.github.com/users', 'github.com')); user.classList.add('user'); var userAvatar = document.createElement('img'); userAvatar.classList.add('avatar'); userAvatar.setAttribute('src', response.user.avatar_url); user.appendChild(userAvatar); var commentLink = document.createElement('a'); commentLink.setAttribute('href', response.html_url); commentLink.classList.add('comment-url'); commentLink.innerHTML = '#' + response.id + ' - ' + response.created_at; var commentContents = document.createElement('div'); commentContents.classList.add('comment-content'); commentContents.innerHTML = response.body; var comment = document.createElement('li'); comment.setAttribute('data-created', response.created_at); comment.setAttribute('data-author-avatar', response.user.avatar_url); comment.setAttribute('data-user-url', response.user.url); comment.appendChild(user); comment.appendChild(commentContents); comment.appendChild(commentLink); return comment; }; /* function createCommentEntryEl(user) { console.log(user); var userEl = document.createElement('a'); userEl.setAttribute('href', user.url.replace('api.github.com/user', 'github.com')); userEl.classList.add('user'); var userAvatar = document.createElement('img'); userAvatar.classList.add('avatar'); userAvatar.setAttribute('src', user.avatar_url); userEl.appendChild(userAvatar); var inputEl = document.createElement('input'); inputEl.setAttribute("type", "text"); inputEl.setAttribute("placeholder", "write a comment"); var buttonEl = document.createElement('a'); buttonEl.classList.add("CommentButton"); var box = document.createElement('li'); box.setAttribute('data-author-avatar', response.user.avatar_url); box.setAttribute('data-user-url', response.user.url); box.appendChild(userEl); box.appendChild(inputEl); box.appendChild(buttonEl); return box; };*/ UpdateComments(); </script> <hr/> <div id="mc_embed_signup_scroll_footer"> <div id="github-comments"> <h2>Comments</h2> <p id="leave-a-comment">Join the discussion for this article on <a href="https://github.com/ahmetcancomtr/ahmetcancomtr.github.io/issues/1/">this ticket</a> and write your comment.</p> <ul id="gh-comments-list"></ul> <p id="no-comments-found">No comments found for this article. Comments posted before 2019-09-15 are no longer available due to a system migration since I no longer use Disqus for comments.</p> </div> </div> </article> </div> </div> </div><footer> <p> <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <script src="https://ahmetcan.com.tr/assets/js/mode-switcher.js"></script> </body> </html>
